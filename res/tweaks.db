###!> name: GavinK88/d2gl-mxl-1.0
###!> version: any
sleep 1.5
github_author=GavinK88
github_repo=d2gl-mxl-1.0
releases_url="https://github.com/${github_author}/${github_repo}/releases"
github_version=$(zenity --entry --title="${github_author}/${github_repo}" --text="$releases_url\n\nEnter GitHub version (e.g. 1.0.5):" --entry-text="1.0.5") || exit 1
file_name="${github_author}-${github_repo}-${github_version}"
file_ext="zip"
download_url="${releases_url}/download/${github_version}/Release.${file_ext}"
mkdir -p "${HOME}/.d2launcher/tweaks/"
echo -e ":: GitHub URL:     ${releases_url}"

# Check version
if [ -n "$github_version" ]; then
    echo -e ":: GitHub Version: ${github_version}"
else
    echo -e ":: Invalid GitHub Version"
    exit 1
fi

# Download if not exists
if [ ! -f "${HOME}/.d2launcher/tweaks/${file_name}.${file_ext}" ]; then
    if curl -Lfs "${download_url}" >"${file_name}.${file_ext}"; then
        mv -f "${file_name}.${file_ext}" "${HOME}/.d2launcher/tweaks/${file_name}.${file_ext}"
    else
        echo -e ":: Error downloading ${download_url}"
        exit 1
    fi
fi

# Unzip
if ! unzip -q -o "${HOME}/.d2launcher/tweaks/${file_name}.${file_ext}" -d "${HOME}/.d2launcher/bin/diablo2"; then
    echo -e ":: Error unzip ${HOME}/.d2launcher/tweaks/${file_name}.${file_ext}"
    exit 1
fi

# Finish
echo -e ":::::::::::::::::::::::::::::::::::::::::::::"
echo -e ":: Please set d2_args to: -3dfx"
echo -e ":: Open settings in Diablo II with: Ctrg + o"
echo -e ":::::::::::::::::::::::::::::::::::::::::::::"

###!> name: FunkyFr3sh/cnc-ddraw
###!> version: latest
github_author=FunkyFr3sh
github_repo=cnc-ddraw
github_version=latest
file_name="${github_author}-${github_repo}-${github_version}"
file_ext="zip"
releases_url="https://github.com/${github_author}/${github_repo}/releases"
download_url="${releases_url}/latest/download/cnc-ddraw.${file_ext}"
mkdir -p "${HOME}/.d2launcher/tweaks/"
echo -e ":: GitHub URL: ${releases_url}"

# Download
if curl -Lfs "${download_url}" >"${file_name}.${file_ext}"; then
    mv -f "${file_name}.${file_ext}" "${HOME}/.d2launcher/tweaks/${file_name}.${file_ext}"
else
    echo -e ":: Error downloading ${download_url}"
    exit 1
fi

# Unzip
if ! unzip -q -o "${HOME}/.d2launcher/tweaks/${file_name}.${file_ext}" -d "${HOME}/.d2launcher/bin/diablo2"; then
    echo -e ":: Error unzip ${HOME}/.d2launcher/tweaks/${file_name}.${file_ext}"
    exit 1
fi

# Finish
echo -e ":::::::::::::::::::::::::::::::::::::::::::::"
echo -e ":: You have to do these steps manually:"
echo -e ":: - Goto Settings > Wine Settings > Library and override/add ddraw (set DLL load strategy to: native then built in)."
echo -e ":: - Goto Settings > Edit Configuration > set d2_args to: -ddraw"
echo -e ":: - Optimize prefered settings: Settings > Direct Draw Settings (optional)"
echo -e ":::::::::::::::::::::::::::::::::::::::::::::"
